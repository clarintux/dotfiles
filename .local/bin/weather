#!/bin/sh

file="/tmp/wttr.jason"

declare -A codes=( \
[113]="‚òÄÔ∏è"   \
[116]="üå§Ô∏è"  \
[119]="‚òÅÔ∏è"   \
[122]="üå•Ô∏è"  \
[143]="üå´Ô∏è"  \
[176]="üå¶Ô∏è"  \
[179]="üåßÔ∏è"  \
[182]="üå®Ô∏è"  \
[185]="üå®Ô∏è"  \
[200]="üå©Ô∏è"  \
[227]="‚ùÑÔ∏è"   \
[230]="‚ùÑÔ∏è"   \
[248]="üå´Ô∏è"  \
[260]="üå´Ô∏è"  \
[263]="üåßÔ∏è"  \
[266]="üåßÔ∏è"  \
[281]="üå¶Ô∏è"  \
[284]="üå¶Ô∏è"  \
[293]="üåßÔ∏è"  \
[296]="üåßÔ∏è"  \
[299]="üåßÔ∏è"  \
[302]="üåßÔ∏è"  \
[305]="üåßÔ∏è"  \
[308]="üåßÔ∏è"  \
[311]="üåßÔ∏è"  \
[314]="üåßÔ∏è"  \
[317]="üåßÔ∏è"  \
[320]="üå®Ô∏è"  \
[323]="üå®Ô∏è"  \
[326]="üå®Ô∏è"  \
[329]="üå®Ô∏è"  \
[332]="üå®Ô∏è"  \
[335]="üå®Ô∏è"  \
[338]="üå®Ô∏è"  \
[350]="üå®Ô∏è"  \
[353]="üåßÔ∏è"  \
[356]="üåßÔ∏è"  \
[359]="üåßÔ∏è"  \
[362]="üå®Ô∏è"  \
[365]="üå®Ô∏è"  \
[368]="üå®Ô∏è"  \
[371]="üå®Ô∏è"  \
[374]="üå®Ô∏è"  \
[377]="üå®Ô∏è"  \
[386]="üå©Ô∏è"  \
[389]="üå®Ô∏è"  \
[392]="üå®Ô∏è"  \
[395]="üå®Ô∏è"  \
[398]="üå®Ô∏è"  \
[401]="üå®Ô∏è"  \
[404]="üå®Ô∏è"  \
[407]="üå®Ô∏è"  \
[410]="üå®Ô∏è"  \
[413]="üå®Ô∏è"  \
[416]="üå®Ô∏è"  \
[419]="üå®Ô∏è"  \
[422]="üå®Ô∏è"  \
[425]="üå®Ô∏è"  \
[428]="üå®Ô∏è"  \
[431]="üå®Ô∏è"  \
)

wget "https://wttr.in/Frankfurt?format=j1" -O $file &> /dev/null

weatherDesc=$(jq '.current_condition.[].weatherDesc.[].value' $file)
temp_C=$(jq '.current_condition.[].temp_C' $file)
wind=$(jq '.current_condition.[].windspeedKmph' $file)
humidity=$(jq '.current_condition.[].humidity' $file)
feels=$(jq '.current_condition.[].FeelsLikeC' $file)


echo -en "\e[1m"
echo "$weatherDesc $temp_C¬∞" | sed 's/"//g'
echo -en '\001\033[0m\002'
echo "Feels like: $feels¬∞" | sed 's/"//g'
echo "Wind: ${wind}Km/h" | sed 's/"//g'
echo "Humidity: ${humidity}%" | sed 's/"//g'

for i in {0..2}
do
    echo
    if [ $i = 0 ]; then
        printf '\e[1m%s\e[m' "Today, "
    elif [ $i = 1 ]; then
        printf '\e[1m%s\e[m' "Tomorrow, "
    fi
    date=$(jq ".weather.[$i].date" $file)
    max=$(jq ".weather.[$i].maxtempC" $file)
    min=$(jq ".weather.[$i].mintempC" $file)
    sunrise=$(jq ".weather.[$i].astronomy.[].sunrise" $file)
    sunset=$(jq ".weather.[$i].astronomy.[].sunset" $file)
    printf '\e[1m%s\e[m\n' $date | sed 's/"//g'
    echo "‚¨ÜÔ∏è  $max  ‚¨á  $min  üåÖ $sunrise  üåá $sunset" | sed 's/"//g'

    for j in {0..7}
    do
        time=$(jq ".weather.[$i].hourly.[$j].time" $file | sed 's/"//g;s/00//g')
        code=$(jq ".weather.[$i].hourly.[$j].weatherCode" $file | sed 's/"//g')
        temp=$(jq ".weather.[$i].hourly.[$j].tempC" $file | sed 's/"//g')
        desc=$(jq ".weather.[$i].hourly.[$j].weatherDesc.[].value" $file | sed 's/"//g')
        if [ "$time" -le 10 ]; then
            printf "0"
        fi
        printf "%s %s %3s %s\n" $time ${codes[$code]} $temp "$desc"
    done

done
