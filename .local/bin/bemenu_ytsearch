#!/bin/sh 

if [ -f $HOME/.config/bemenurc ]; then
  . $HOME/.config/bemenurc
else
  BEMENU='bemenu -i'
fi

url_yt="https://invidious.snopyta.org/search?q="

search=$(echo | $BEMENU -p "YouTube search:")

[[ ! $search ]] && exit

url=${url_yt}${search}

output=$(torsocks wget -qO- "$url")

result="$(echo "$output" | grep -E "youtube.com/watch|p dir" | sed ':a;N;$!ba;s/<\/p><\/a>\n//g' | sed 's/.*auto">//g;s/<a title=.*href="//g;s/">//g;s/www.youtube.com/invidious.snopyta.org/g')"

select="$(echo "$result" | $BEMENU -l 20 -p Videos:)"

[[ ! $select ]] && exit

echo "$select" | cut -d "^" -f2 | xargs torsocks mpv --script-opts=ytdl_hook-ytdl_path=yt-dlp &>/dev/null
